<!DOCTYPE html>
<html lang="tr">
<head>
  <meta charset="UTF-8" />
  <title>Otman 3D – Echo Plains</title>
  <style>
    html, body {
      margin: 0;
      padding: 0;
      width: 100%;
      height: 100%;
      overflow: hidden;
      font-family: system-ui, -apple-system, BlinkMacSystemFont, "Segoe UI", sans-serif;
      background: #0b1020;
      color: #f5f5f5;
    }
    #uiTop {
      position: absolute;
      top: 8px;
      left: 50%;
      transform: translateX(-50%);
      text-align: center;
      z-index: 10;
      pointer-events: none;
    }
    #title {
      font-weight: 700;
      font-size: 18px;
      text-shadow: 0 0 8px rgba(0,0,0,0.7);
    }
    #hint {
      margin-top: 4px;
      background: rgba(0,0,0,0.55);
      padding: 6px 12px;
      border-radius: 10px;
      font-size: 13px;
      display: inline-block;
      box-shadow: 0 0 8px rgba(0,0,0,0.6);
    }
    #bottom {
      position: absolute;
      bottom: 8px;
      left: 50%;
      transform: translateX(-50%);
      background: rgba(0,0,0,0.6);
      padding: 6px 12px;
      border-radius: 10px;
      font-size: 13px;
      max-width: 600px;
      text-align: center;
      z-index: 10;
      box-shadow: 0 0 8px rgba(0,0,0,0.7);
      pointer-events: none;
    }
    #nameTag {
      position: absolute;
      left: 50%;
      top: 50%;
      transform: translate(-50%, -120%);
      color: #ffe9a6;
      font-weight: 600;
      text-shadow: 0 0 5px rgba(0,0,0,0.8);
      pointer-events: none;
      z-index: 9;
    }
    canvas {
      display: block;
    }
  </style>
</head>
<body>
  <div id="uiTop">
    <div id="title">OTMAN 3D – ECHO PLAINS</div>
    <div id="hint">W, A, S, D ile hareket et. Shift ile daha hızlı koş.</div>
  </div>
  <div id="nameTag">Otman</div>
  <div id="bottom">
    Uzakta parlayan kristali bul. Burası sisli ama karanlık değil; rüzgârın ve ışığın olduğu açık bir ova.
  </div>

  <!-- Three.js CDN -->
  <script src="https://unpkg.com/three@0.160.0/build/three.min.js"></script>

  <script>
    // === TEMEL THREE.JS KURULUMU ===
    const scene = new THREE.Scene();

    // Hafif mavi bir gökyüzü & ufuk ortamı
    const skyColor = new THREE.Color(0x7abaff);
    const groundColor = new THREE.Color(0x1b4f39);
    scene.fog = new THREE.FogExp2(0x87a8ff, 0.012);

    const camera = new THREE.PerspectiveCamera(
      60,
      window.innerWidth / window.innerHeight,
      0.1,
      1000
    );

    const renderer = new THREE.WebGLRenderer({ antialias: true });
    renderer.setSize(window.innerWidth, window.innerHeight);
    renderer.setPixelRatio(window.devicePixelRatio || 1);
    renderer.setClearColor(0x0b1020);
    document.body.appendChild(renderer.domElement);

    // IŞIKLAR
    const hemiLight = new THREE.HemisphereLight(0xffffff, 0x335533, 0.8);
    scene.add(hemiLight);

    const dirLight = new THREE.DirectionalLight(0xffffff, 0.8);
    dirLight.position.set(20, 40, 10);
    dirLight.castShadow = true;
    scene.add(dirLight);

    // ZEMİN
    const groundGeo = new THREE.PlaneGeometry(200, 200, 40, 40);
    const groundMat = new THREE.MeshLambertMaterial({
      color: 0x2f7f55
    });
    const ground = new THREE.Mesh(groundGeo, groundMat);
    ground.rotation.x = -Math.PI / 2;
    ground.receiveShadow = true;
    scene.add(ground);

    // Hafif "yol" efekti için ortadan geçen farklı renkli şerit
    const pathGeo = new THREE.PlaneGeometry(10, 160);
    const pathMat = new THREE.MeshLambertMaterial({ color: 0x3c9272 });
    const path = new THREE.Mesh(pathGeo, pathMat);
    path.rotation.x = -Math.PI / 2;
    path.position.z = -10;
    scene.add(path);

    // DEKORATİF AĞAÇLAR / KAYALAR
    function addTree(x, z) {
      const trunkGeo = new THREE.CylinderGeometry(0.3, 0.5, 3, 8);
      const trunkMat = new THREE.MeshLambertMaterial({ color: 0x5b3a29 });
      const trunk = new THREE.Mesh(trunkGeo, trunkMat);
      trunk.position.set(x, 1.5, z);
      trunk.castShadow = true;

      const crownGeo = new THREE.ConeGeometry(2.2, 4, 10);
      const crownMat = new THREE.MeshLambertMaterial({ color: 0x2f8f46 });
      const crown = new THREE.Mesh(crownGeo, crownMat);
      crown.position.set(x, 4.7, z);
      crown.castShadow = true;

      scene.add(trunk, crown);
    }

    function addRock(x, z) {
      const geo = new THREE.DodecahedronGeometry(1.2);
      const mat = new THREE.MeshLambertMaterial({ color: 0x9ba3b0 });
      const rock = new THREE.Mesh(geo, mat);
      rock.position.set(x, 1.2, z);
      rock.castShadow = true;
      scene.add(rock);
    }

    for (let i = 0; i < 14; i++) {
      addTree(
        (Math.random() - 0.5) * 160,
        (Math.random() - 0.5) * 160
      );
    }
    for (let i = 0; i < 18; i++) {
      addRock(
        (Math.random() - 0.5) * 170,
        (Math.random() - 0.5) * 170
      );
    }

    // === OTMAN KARAKTERİ ===
    const otman = new THREE.Group();

    // Gövde
    const bodyGeo = new THREE.CapsuleGeometry(1, 2, 6, 10);
    const bodyMat = new THREE.MeshPhongMaterial({
      color: 0x3a5fff,
      shininess: 80
    });
    const body = new THREE.Mesh(bodyGeo, bodyMat);
    body.castShadow = true;
    body.position.y = 2;
    otman.add(body);

    // Kafa
    const headGeo = new THREE.SphereGeometry(0.9, 16, 16);
    const headMat = new THREE.MeshPhongMaterial({ color: 0xffe1c1 });
    const head = new THREE.Mesh(headGeo, headMat);
    head.position.y = 3.7;
    head.castShadow = true;
    otman.add(head);

    // Basit "miğfer"
    const helmGeo = new THREE.CylinderGeometry(0.7, 0.9, 0.7, 12);
    const helmMat = new THREE.MeshPhongMaterial({ color: 0x404860 });
    const helm = new THREE.Mesh(helmGeo, helmMat);
    helm.position.y = 4.2;
    otman.add(helm);

    // Gölge için küçük disk
    const shadowGeo = new THREE.CircleGeometry(1.6, 20);
    const shadowMat = new THREE.MeshBasicMaterial({
      color: 0x000000,
      opacity: 0.4,
      transparent: true
    });
    const shadow = new THREE.Mesh(shadowGeo, shadowMat);
    shadow.rotation.x = -Math.PI / 2;
    shadow.position.y = 0.01;
    otman.add(shadow);

    otman.position.set(0, 0, 20);
    scene.add(otman);

    // === SES KAYNAĞI / KRİSTAL ===
    const crystalGeo = new THREE.OctahedronGeometry(1.2);
    const crystalMat = new THREE.MeshPhongMaterial({
      color: 0x68f7ff,
      emissive: 0x1f6cff,
      emissiveIntensity: 0.7,
      shininess: 120
    });
    const crystal = new THREE.Mesh(crystalGeo, crystalMat);
    crystal.castShadow = true;
    crystal.position.set(0, 1.8, -30);
    scene.add(crystal);

    const crystalGlowGeo = new THREE.SphereGeometry(2.6, 16, 16);
    const crystalGlowMat = new THREE.MeshBasicMaterial({
      color: 0x7eeaff,
      transparent: true,
      opacity: 0.25
    });
    const glow = new THREE.Mesh(crystalGlowGeo, crystalGlowMat);
    glow.position.copy(crystal.position);
    scene.add(glow);

    // Kamera başlangıç pozisyonu (üstten açılı, Mobile Legends hissi)
    camera.position.set(0, 22, 32);
    camera.lookAt(otman.position);

    // === KONTROLLER ===
    const keys = {};
    window.addEventListener("keydown", (e) => {
      keys[e.key.toLowerCase()] = true;
    });
    window.addEventListener("keyup", (e) => {
      keys[e.key.toLowerCase()] = false;
    });

    let lastTime = performance.now();

    function update(dt) {
      const sec = dt / 1000;
      const walkSpeed = keys["shift"] ? 18 : 10; // Shift = koşma
      let vx = 0;
      let vz = 0;

      // W,A,S,D ekranda normal yönlerde:
      // W: yukarı, S: aşağı, A: sol, D: sağ
      if (keys["w"]) vz -= 1;
      if (keys["s"]) vz += 1;
      if (keys["a"]) vx -= 1;
      if (keys["d"]) vx += 1;

      if (vx !== 0 || vz !== 0) {
        const len = Math.hypot(vx, vz);
        vx /= len;
        vz /= len;

        otman.position.x += vx * walkSpeed * sec;
        otman.position.z += vz * walkSpeed * sec;

        // Otman'ın baktığı yön (Mobile legends gibi döner)
        otman.rotation.y = Math.atan2(vx, vz);
      }

      // Sınırlar
      const limit = 95;
      otman.position.x = Math.max(-limit, Math.min(limit, otman.position.x));
      otman.position.z = Math.max(-limit, Math.min(limit, otman.position.z));

      // Kamera, Otman'ı takip etsin (üstten hafif açılı)
      camera.position.x = otman.position.x;
      camera.position.z = otman.position.z + 24;
      camera.position.y = 22;
      camera.lookAt(otman.position.x, otman.position.y + 3, otman.position.z);

      // Kristale ne kadar yakın?
      const dx = crystal.position.x - otman.position.x;
      const dz = crystal.position.z - otman.position.z;
      const dist = Math.hypot(dx, dz);

      const bottom = document.getElementById("bottom");
      if (dist > 5) {
        bottom.textContent =
          "Otman: \"Şu parlayan kristale yaklaşmam gerek... W, A, S, D ile ilerle. Shift ile koş.\"";
      } else {
        bottom.textContent =
          "Kristalden bir ses geliyor: \"Beni buldun, Otman... Bu topraklar artık senin efsanenin başlangıcı.\"";
      }

      // Kristal hafif dönsün ve parlasın
      crystal.rotation.y += sec * 1.2;
      glow.rotation.y -= sec * 0.6;
    }

    function animate() {
      const now = performance.now();
      const dt = now - lastTime;
      lastTime = now;

      update(dt);
      renderer.render(scene, camera);
      requestAnimationFrame(animate);
    }
    animate();

    // Resize
    window.addEventListener("resize", () => {
      camera.aspect = window.innerWidth / window.innerHeight;
      camera.updateProjectionMatrix();
      renderer.setSize(window.innerWidth, window.innerHeight);
    });
  </script>
</body>
</html>
